<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–∏—ë–º–∫–∏ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.5;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            vertical-align: top;
            word-wrap: break-word;
        }
        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
        }
        .room-row {
            background-color: #f9f9f9;
            font-weight: bold;
        }
        .plaster-row {
            background-color: #fff;
            font-style: italic;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button, input, select {
            padding: 8px 12px;
            font-size: 14px;
        }
        textarea, input[type="text"] {
            width: 100%;
            min-height: 40px;
            resize: vertical;
            border: 1px solid #ccc;
            padding: 5px;
            box-sizing: border-box;
            font-family: inherit;
        }
        .small-input {
            width: 60px;
        }
        .medium-input {
            width: 120px;
        }
        .defect-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        .defect-tag {
            background: #ffecec;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            display: inline-block;
        }
        .material-group {
            margin-bottom: 8px;
        }
        .material-group label {
            display: block;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>–ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–∏—ë–º–∫–∏ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–µ–π</h1>
    
    <div class="controls">
        <input type="text" id="objectName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞" style="flex-grow: 1;">
        <button onclick="addRow()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å</button>
        <button onclick="saveChecklist()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button onclick="loadChecklist()">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        <select id="savedLists" onchange="loadSelected()">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π --</option>
        </select>
    </div>

    <table id="checklistTable">
        <colgroup>
            <col width="40">  <!-- ‚Ññ -->
            <col width="200"> <!-- –ü–æ–º–µ—â–µ–Ω–∏–µ –∏ –ø–ª–æ—Å–∫–æ—Å—Ç—å -->
            <col width="250"> <!-- –ú–∞—Ç–µ—Ä–∏–∞–ª –æ—Å–Ω–æ–≤–∞–Ω–∏—è -->
            <col width="200"> <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–¥–µ–ª–∫–∏ -->
            <col width="150"> <!-- –î–µ—Ñ–µ–∫—Ç—ã -->
            <col width="200"> <!-- –ü—Ä–∏–º–µ—á–∞–Ω–∏—è -->
        </colgroup>
        <thead>
            <tr>
                <th>‚Ññ</th>
                <th>–ü–æ–º–µ—â–µ–Ω–∏–µ –∏ –ø–ª–æ—Å–∫–æ—Å—Ç—å</th>
                <th>–ú–∞—Ç–µ—Ä–∏–∞–ª –æ—Å–Ω–æ–≤–∞–Ω–∏—è</th>
                <th>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–¥–µ–ª–∫–∏</th>
                <th>–î–µ—Ñ–µ–∫—Ç—ã</th>
                <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- –°—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
        </tbody>
    </table>

    <script>
        // –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤
        const ROOM_TYPES = ["–°–ø–∞–ª—å–Ω—è", "–ì–æ—Å—Ç–∏–Ω–∞—è", "–ö—É—Ö–Ω—è", "–í–∞–Ω–Ω–∞—è", "–ö–æ—Ä–∏–¥–æ—Ä", "–û—Ñ–∏—Å"];
        const PLANE_TYPES = ["–°—Ç–µ–Ω–∞", "–ü–æ—Ç–æ–ª–æ–∫", "–ü–æ–ª", "–û—Ç–∫–æ—Å", "–î–≤–µ—Ä—å", "–ö–æ–ª–æ–Ω–Ω–∞", "–ê—Ä–∫–∞"];
        
        // –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –æ—Å–Ω–æ–≤–∞–Ω–∏—è
        const BASE_MATERIALS = ["–ì–ö–õ", "–ì–í–õ", "–§–∞–Ω–µ—Ä–∞", "–û–°–ë", "–¶–µ–º–µ–Ω—Ç–Ω–∞—è —Å—Ç—è–∂–∫–∞", "–ö–∏—Ä–ø–∏—á", "–ë–µ—Ç–æ–Ω"];
        const BRANDS = ["Knauf", "Ceresit", "Bergauf", "–û—Å–Ω–æ–≤–∏—Ç", "–í–æ–ª–º–∞", "Unis", "Litokol"];
        
        // –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–∫—Ä—ã—Ç–∏—è
        const DECORATIVE_TYPES = [
            "–ú–∏–∫—Ä–æ—Ü–µ–º–µ–Ω—Ç", "–ò–º–æ–ª–∞", "–ó–∞–º—à–∞", "–®–µ–ª–∫", 
            "–°—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–æ", "–ü–æ–∫—Ä–∞—Å–∫–∞", "2-—Å–ª–æ–π–∫–∞ –∏–∑–≤–µ—Å—Ç—å", 
            "2-—Å–ª–æ–π–∫–∞ –∞–∫—Ä–∏–ª", "–ö–≤–∞—Ä—Ü–º–∞—Ç", "–¢—Ä–∞–≤–µ—Ä—Ç–∏–Ω", "–°–∫–∞–ª–∞"
        ];
        
        const DEFECTS = ["–¶–∞—Ä–∞–ø–∏–Ω—ã", "–°–∫–æ–ª—ã", "–†—ã—Ö–ª–æ—Å—Ç—å", "–ù–∞–ø–ª—ã–≤—ã", "–ù–µ–æ—à–∫—É—Ä–µ–Ω–æ", "–û—Ç—Å–ª–æ–µ–Ω–∏—è", "–ü—è—Ç–Ω–∞"];

        let rowCount = 0;

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
        function addRow(roomData = null) {
            const tbody = document.getElementById('tableBody');
            rowCount++;
            
            // –°—Ç—Ä–æ–∫–∞ —Å –ø–æ–º–µ—â–µ–Ω–∏–µ–º
            const roomRow = document.createElement('tr');
            roomRow.className = 'room-row';
            roomRow.innerHTML = `
                <td rowspan="2">${rowCount}</td>
                <td>
                    <select class="room-type">
                        <option value="">–¢–∏–ø –ø–æ–º–µ—â–µ–Ω–∏—è</option>
                        ${ROOM_TYPES.map(t => `
                            <option value="${t}" ${roomData?.roomType === t ? 'selected' : ''}>${t}</option>
                        `).join('')}
                    </select>
                    <div style="margin-top:5px">
                        <select class="plane-type">
                            <option value="">–¢–∏–ø –ø–ª–æ—Å–∫–æ—Å—Ç–∏</option>
                            ${PLANE_TYPES.map(t => `
                                <option value="${t}" ${roomData?.planeType === t ? 'selected' : ''}>${t}</option>
                            `).join('')}
                        </select>
                        <input type="number" class="small-input" min="1" value="${roomData?.planeCount || 1}" placeholder="–ö–æ–ª-–≤–æ" style="margin-top:5px">
                    </div>
                </td>
                <td>
                    <div class="material-group">
                        <label>–û—Å–Ω–æ–≤–∞–Ω–∏–µ:</label>
                        <select class="base-material">
                            <option value="">–¢–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞</option>
                            ${BASE_MATERIALS.map(m => `
                                <option value="${m}" ${roomData?.baseMaterial === m ? 'selected' : ''}>${m}</option>
                            `).join('')}
                        </select>
                        <input type="text" placeholder="–ë—Ä–µ–Ω–¥" value="${roomData?.baseBrand || ''}" style="margin-top:5px">
                    </div>
                    
                    <div class="material-group">
                        <label>–ì–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏—è:</label>
                        <input type="text" placeholder="–¢–∏–ø" value="${roomData?.waterproofingType || ''}">
                        <input type="text" placeholder="–ë—Ä–µ–Ω–¥" value="${roomData?.waterproofingBrand || ''}" style="margin-top:5px">
                    </div>
                    
                    <div class="material-group">
                        <label>–®–ø–∞–∫–ª—ë–≤–∫–∞:</label>
                        <input type="text" placeholder="–¢–∏–ø" value="${roomData?.puttyType || ''}">
                        <input type="text" placeholder="–ë—Ä–µ–Ω–¥" value="${roomData?.puttyBrand || ''}" style="margin-top:5px">
                    </div>
                    
                    <div class="material-group">
                        <label>–ì—Ä—É–Ω—Ç–æ–≤–∫–∞:</label>
                        <input type="text" placeholder="–¢–∏–ø" value="${roomData?.primerType || ''}">
                        <input type="text" placeholder="–ë—Ä–µ–Ω–¥" value="${roomData?.primerBrand || ''}" style="margin-top:5px">
                    </div>
                </td>
                <td rowspan="2">
                    <select class="decorative-type">
                        <option value="">–¢–∏–ø –ø–æ–∫—Ä—ã—Ç–∏—è</option>
                        ${DECORATIVE_TYPES.map(t => `
                            <option value="${t}" ${roomData?.decorativeType === t ? 'selected' : ''}>${t}</option>
                        `).join('')}
                    </select>
                    <textarea placeholder="–°–≤–æ–π—Å—Ç–≤–∞ –∏ —Ç–æ–ª—â–∏–Ω–∞" style="margin-top:5px;min-height:60px">${roomData?.decorativeProps || ''}</textarea>
                </td>
                <td>
                    <div class="defect-list" id="defects-${rowCount}"></div>
                    <select class="defect-selector" onchange="addDefect(${rowCount})" style="margin-top:5px">
                        <option value="">–î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ñ–µ–∫—Ç</option>
                        ${DEFECTS.map(d => `<option value="${d}">${d}</option>`).join('')}
                    </select>
                </td>
                <td rowspan="2">
                    <textarea placeholder="–û—Å–æ–±—ã–µ –æ—Ç–º–µ—Ç–∫–∏" style="min-height:100px">${roomData?.notes || ''}</textarea>
                </td>
            `;
            
            // –°—Ç—Ä–æ–∫–∞ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
            const plasterRow = document.createElement('tr');
            plasterRow.className = 'plaster-row';
            plasterRow.innerHTML = `
                <td>
                    <textarea placeholder="–î–æ–ø. –æ–ø–∏—Å–∞–Ω–∏–µ –ø–ª–æ—Å–∫–æ—Å—Ç–∏">${roomData?.planeDetails || ''}</textarea>
                </td>
                <td>
                    <textarea placeholder="–î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º">${roomData?.materialsNotes || ''}</textarea>
                </td>
                <td>
                    <textarea placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã">${roomData?.additionalDefects || ''}</textarea>
                </td>
            `;
            
            tbody.appendChild(roomRow);
            tbody.appendChild(plasterRow);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã
            if (roomData?.defects) {
                roomData.defects.forEach(defect => {
                    addDefect(rowCount, defect);
                });
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–∞
        function addDefect(rowId, defectText = null) {
            const defectContainer = document.getElementById(`defects-${rowId}`);
            const selector = defectContainer.nextElementSibling;
            
            const defect = defectText || selector.value;
            if (!defect) return;
            
            const tag = document.createElement('span');
            tag.className = 'defect-tag';
            tag.textContent = defect;
            tag.onclick = () => tag.remove();
            
            defectContainer.appendChild(tag);
            selector.value = '';
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ–∫-–ª–∏—Å—Ç–∞
        function saveChecklist() {
            const objectName = document.getElementById('objectName').value.trim();
            if (!objectName) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞");
            
            const checklists = [];
            const roomRows = document.querySelectorAll('#tableBody .room-row');
            
            roomRows.forEach(roomRow => {
                const plasterRow = roomRow.nextElementSibling;
                
                checklists.push({
                    // –ü–æ–º–µ—â–µ–Ω–∏–µ –∏ –ø–ª–æ—Å–∫–æ—Å—Ç—å
                    roomType: roomRow.querySelector('.room-type').value,
                    planeType: roomRow.querySelector('.plane-type').value,
                    planeCount: roomRow.querySelector('.small-input').value,
                    planeDetails: plasterRow.querySelector('td:nth-child(1) textarea').value,
                    
                    // –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –æ—Å–Ω–æ–≤–∞–Ω–∏—è
                    baseMaterial: roomRow.querySelector('.base-material').value,
                    baseBrand: roomRow.querySelector('.material-group:nth-child(1) input[type="text"]').value,
                    waterproofingType: roomRow.querySelector('.material-group:nth-child(2) input[type="text"]').value,
                    waterproofingBrand: roomRow.querySelector('.material-group:nth-child(2) input[type="text"]:nth-child(3)').value,
                    puttyType: roomRow.querySelector('.material-group:nth-child(3) input[type="text"]').value,
                    puttyBrand: roomRow.querySelector('.material-group:nth-child(3) input[type="text"]:nth-child(3)').value,
                    primerType: roomRow.querySelector('.material-group:nth-child(4) input[type="text"]').value,
                    primerBrand: roomRow.querySelector('.material-group:nth-child(4) input[type="text"]:nth-child(3)').value,
                    materialsNotes: plasterRow.querySelector('td:nth-child(2) textarea').value,
                    
                    // –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
                    decorativeType: roomRow.querySelector('.decorative-type').value,
                    decorativeProps: roomRow.querySelector('td:nth-child(4) textarea').value,
                    
                    // –î–µ—Ñ–µ–∫—Ç—ã
                    defects: Array.from(roomRow.querySelectorAll('.defect-tag')).map(tag => tag.textContent),
                    additionalDefects: plasterRow.querySelector('td:nth-child(3) textarea').value,
                    
                    // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
                    notes: roomRow.querySelector('td:nth-child(6) textarea').value
                });
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem(`checklist_${objectName}`, JSON.stringify({
                name: objectName,
                items: checklists
            }));
            
            updateSavedLists();
            alert(`–ß–µ–∫-–ª–∏—Å—Ç "${objectName}" —Å–æ—Ö—Ä–∞–Ω—ë–Ω!`);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫-–ª–∏—Å—Ç–∞
        function loadChecklist(objectName = null) {
            const name = objectName || document.getElementById('objectName').value.trim();
            if (!name) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞");
            
            const savedData = localStorage.getItem(`checklist_${name}`);
            if (!savedData) return alert("–ß–µ–∫-–ª–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω");
            
            const data = JSON.parse(savedData);
            document.getElementById('objectName').value = data.name;
            document.getElementById('tableBody').innerHTML = '';
            rowCount = 0;
            
            data.items.forEach(item => {
                addRow(item);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —á–µ–∫-–ª–∏—Å—Ç–æ–≤
        function updateSavedLists() {
            const select = document.getElementById('savedLists');
            select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π --</option>';
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('checklist_')) {
                    const option = document.createElement('option');
                    option.value = key.replace('checklist_', '');
                    option.textContent = option.value;
                    select.appendChild(option);
                }
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —á–µ–∫-–ª–∏—Å—Ç–∞
        function loadSelected() {
            const selected = document.getElementById('savedLists').value;
            if (selected) loadChecklist(selected);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            updateSavedLists();
            addRow(); // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—É—é –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
        };
    </script>
</body>
</html>
